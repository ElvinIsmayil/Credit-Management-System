@model CategoryCreateVM

@{
    ViewData["Title"] = "Create Category";
}

<!-- Card Wrapper -->
<div class="card card-flush shadow-sm">
    <div class="card-header">
        <h3 class="card-title text-dark fw-bold">@ViewData["Title"]</h3>
    </div>

    <div class="card-body pt-0">
        <form asp-action="Create" enctype="multipart/form-data" method="post" class="form" novalidate>
            <div asp-validation-summary="All" class="alert alert-danger"></div>

            <!-- Category Name -->
            <div class="fv-row mb-7">
                <label asp-for="Name" class="required fw-semibold fs-6 mb-2">Category Name</label>
                <input asp-for="Name" class="form-control form-control-solid" />
                <span asp-validation-for="Name" class="text-danger small"></span>
            </div>

            <!-- Description -->
            <div class="fv-row mb-7">
                <label asp-for="Description" class="fw-semibold fs-6 mb-2">Description</label>
                <textarea asp-for="Description" rows="3" class="form-control form-control-solid"></textarea>
                <span asp-validation-for="Description" class="text-danger small"></span>
            </div>

            <!-- Image Upload -->
            <div class="fv-row mb-7">
                <label asp-for="Image" class="fw-semibold fs-6 mb-2">Category Image</label>
                <input asp-for="Image" type="file" class="form-control form-control-solid" />
                <span asp-validation-for="Image" class="text-danger small"></span>
            </div>

            <!-- Parent Category Dropdown -->
            <div class="fv-row mb-7">
                <label asp-for="ParentCategoryId" class="fw-semibold fs-6 mb-2">Parent Category</label>
                <select asp-for="ParentCategoryId" class="form-select form-select-solid">
                    <option value="">-- Select Parent Category --</option>
                    @foreach (var category in Model.ParentCategories)
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                </select>
                <span asp-validation-for="ParentCategoryId" class="text-danger small"></span>
            </div>

            <!-- Subcategories -->
            <div class="card card-flush border mb-7">
                <div class="card-header">
                    <h4 class="card-title fw-bold text-gray-700">Subcategories</h4>
                </div>
                <div class="card-body">
                    <div class="subcategoriesContainer">
                        @for (int i = 0; i < Model.SubCategories.Count; i++)
                        {
                            <div class="d-flex gap-4 align-items-center mb-4 subcategoryRow">
                                <input type="text" name="SubCategories[@i].Name" placeholder="Subcategory Name"
                                       value="@Model.SubCategories[i].Name"
                                       class="form-control form-control-solid flex-grow-1" />
                                <button type="button" class="btn btn-danger removeSubCategoryBtn">
                                    <i class="bi bi-trash-fill"></i>
                                </button>
                            </div>
                        }
                    </div>

                    <button type="button" id="addSubCategoryBtn" class="btn btn-light-primary">
                        <i class="bi bi-plus-lg me-2"></i>Add Subcategory
                    </button>
                </div>
            </div>

            <!-- Submit -->
            <div class="text-end">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-lg me-2"></i>Create Category
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Scripts -->
@section Scripts {
    <script>
        let subcategoryIndex = @Model.SubCategories.Count;

        document.getElementById('addSubCategoryBtn').addEventListener('click', function () {
            var container = document.querySelector('.subcategoriesContainer');
            var newSubCategory = document.createElement('div');
            newSubCategory.classList.add('d-flex', 'gap-4', 'align-items-center', 'mb-4', 'subcategoryRow');

            var subCategoryInput = document.createElement('input');
            subCategoryInput.type = 'text';
            subCategoryInput.name = `SubCategories[${subcategoryIndex}].Name`;
            subCategoryInput.placeholder = 'Subcategory Name';
            subCategoryInput.classList.add('form-control', 'form-control-solid', 'flex-grow-1');

            var removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.classList.add('btn', 'btn-danger', 'removeSubCategoryBtn');
            removeButton.innerHTML = '<i class="bi bi-trash-fill"></i>';

            removeButton.addEventListener('click', function () {
                newSubCategory.remove();
            });

            newSubCategory.appendChild(subCategoryInput);
            newSubCategory.appendChild(removeButton);
            container.appendChild(newSubCategory);

            subcategoryIndex++;
        });
    </script>
}
